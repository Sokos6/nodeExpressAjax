<!doctype html>
<html>

<head>
    <title>RESTful Words Client</title>
    <script>
        window.addEventListener("load", function () {
            var searchField = document.getElementById("searchWord");
            var searchList = document.getElementById("wordlist");
            searchField.addEventListener("keyup", function (evt) {
                var abbrev = searchField.value;
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        searchList.innerHTML = "";
                        for (var i = 0; i < xhr.response.length; i++) {
                            var opt = document.createElement("option");
                            opt.value = xhr.response[i].id;
                            opt.label = xhr.response[i].word;
                            searchList.appendChild(opt);
                        }
                    }
                }
                var uri = "/wordsapi/v1/search/" + abbrev;
                xhr.open("GET", uri);
                xhr.responseType = 'json';
                xhr.send();
            }); //Word search keyup callback
            searchList.addEventListener("change", function () {
                searchField.value = searchList.options[searchList.selectedIndex].label;
            })

            //test
            var countField = document.getElementById("countWord");
            var countDisplay = document.getElementById("displayCount");
            countField.addEventListener("keyup", function (evt) {
                var abbrev = countField.value;
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        //var resp = JSON.parse(xhr.responseText);
                        var resp = xhr.response;
                        //countDisplay.innerHTML = "<li>" + resp.count + " words match " + resp.abbrev + "</li>";
                        countDisplay.innerHTML = "";
                        for (var i = 0; i < resp.length; i++) {
                            var item = document.createElement("li");
                            item.innerHTML = resp[i].count + " words match " + resp[i].abbrev;
                            countDisplay.appendChild(item);
                        }
                    }
                }
                xhr.open("GET", "/wordsapi/v1/count/" + abbrev);
                xhr.responseType = 'json';
                xhr.send();
            });
        });
    </script>
</head>

<body>
    <div id="wordcounts">
        <h4>Count:</h4>
        <input name="countWord" id="countWord">
        <ul id="displayCount"></ul>
    </div>
    <div id="wordsearch">
        <h4>Search:</h4>
        <input name="searchWord" id="searchWord" size="45" type="text">
        <br>
        <select id="wordlist" size="10" style="width: 45ex;"></select>
    </div>
</body>

</html>